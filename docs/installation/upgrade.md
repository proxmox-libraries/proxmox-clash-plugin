# ç‰ˆæœ¬å‡çº§è„šæœ¬è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

`upgrade.sh` æ˜¯ Proxmox Clash æ’ä»¶çš„ç‰ˆæœ¬å‡çº§å·¥å…·ï¼Œæä¾›å®Œæ•´çš„ç‰ˆæœ¬ç®¡ç†åŠŸèƒ½ã€‚

## ğŸ”§ åŠŸèƒ½ç‰¹æ€§

- **è‡ªåŠ¨ç‰ˆæœ¬æ£€æµ‹** - ä» GitHub API è·å–æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯
- **æ™ºèƒ½ç‰ˆæœ¬æ¯”è¾ƒ** - æ”¯æŒè¯­ä¹‰åŒ–ç‰ˆæœ¬å·æ¯”è¾ƒ
- **è‡ªåŠ¨å¤‡ä»½** - å‡çº§å‰è‡ªåŠ¨åˆ›å»ºå®Œæ•´å¤‡ä»½
- **é™çº§æ”¯æŒ** - æ”¯æŒé™çº§åˆ°è¾ƒä½ç‰ˆæœ¬ï¼ˆéœ€ç”¨æˆ·ç¡®è®¤ï¼‰
- **é”™è¯¯æ¢å¤** - å‡çº§å¤±è´¥æ—¶å¯ä»å¤‡ä»½æ¢å¤
- **è¯¦ç»†æ—¥å¿—** - å®Œæ•´çš„å‡çº§è¿‡ç¨‹æ—¥å¿—è®°å½•

## ğŸ“ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬è¯­æ³•
```bash
sudo /opt/proxmox-clash/scripts/management/upgrade.sh [é€‰é¡¹]
```

### é€‰é¡¹è¯´æ˜

| é€‰é¡¹ | é•¿é€‰é¡¹ | è¯´æ˜ |
|------|--------|------|
| `-v VERSION` | `--version VERSION` | å‡çº§åˆ°æŒ‡å®šç‰ˆæœ¬ |
| `-l` | `--latest` | å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ |
| `-c` | `--check` | æ£€æŸ¥å¯ç”¨æ›´æ–° |
| `-b` | `--backup` | åˆ›å»ºå¤‡ä»½ |
| `-r BACKUP` | `--restore BACKUP` | ä»å¤‡ä»½æ¢å¤ |
| `-h` | `--help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### æ£€æŸ¥æ›´æ–°
```bash
sudo /opt/proxmox-clash/scripts/management/upgrade.sh -c
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ğŸ”„ å‘ç°æ–°ç‰ˆæœ¬: v1.1.0
   å½“å‰ç‰ˆæœ¬: v1.0.0
```

### å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬
```bash
sudo /opt/proxmox-clash/scripts/management/upgrade.sh -l
```

**å‡çº§è¿‡ç¨‹ï¼š**
1. æ£€æŸ¥å½“å‰ç‰ˆæœ¬
2. è·å–æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯
3. åˆ›å»ºè‡ªåŠ¨å¤‡ä»½
4. ä¸‹è½½æ–°ç‰ˆæœ¬æ–‡ä»¶
5. åœæ­¢ clash-meta æœåŠ¡
6. æ›´æ–°æ’ä»¶æ–‡ä»¶
7. å¯åŠ¨ clash-meta æœåŠ¡
8. æ¸…ç†ä¸´æ—¶æ–‡ä»¶

### å‡çº§åˆ°æŒ‡å®šç‰ˆæœ¬
```bash
sudo /opt/proxmox-clash/scripts/management/upgrade.sh -v 1.1.0
```

### åˆ›å»ºå¤‡ä»½
```bash
sudo /opt/proxmox-clash/scripts/management/upgrade.sh -b
```

**å¤‡ä»½å†…å®¹ï¼š**
- API æ’ä»¶æ–‡ä»¶ (`Clash.pm`)
- UI æ’ä»¶æ–‡ä»¶ (`pve-panel-clash.js`)
- é…ç½®æ–‡ä»¶ç›®å½• (`config/`)
- è„šæœ¬æ–‡ä»¶ç›®å½• (`scripts/`)
- ç‰ˆæœ¬ä¿¡æ¯æ–‡ä»¶ (`version`)

### ä»å¤‡ä»½æ¢å¤
```bash
sudo /opt/proxmox-clash/scripts/management/upgrade.sh -r backup_20231201_143022
```

## ğŸ“ æ–‡ä»¶ç»“æ„

### å¤‡ä»½ç›®å½•
```
/opt/proxmox-clash/backup/
â”œâ”€â”€ backup_20231201_143022/
â”‚   â”œâ”€â”€ Clash.pm
â”‚   â”œâ”€â”€ pve-panel-clash.js
â”‚   â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ backup_info.txt
â””â”€â”€ backup_20231201_150000/
    â””â”€â”€ ...
```

### ç‰ˆæœ¬æ–‡ä»¶
```
/opt/proxmox-clash/version
```

## ğŸ” ç‰ˆæœ¬æ¯”è¾ƒé€»è¾‘

è„šæœ¬ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬å·æ¯”è¾ƒï¼š

- **ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·** (å¦‚: 1.2.3)
- æ”¯æŒ `v` å‰ç¼€ (å¦‚: v1.2.3)
- ä»å·¦åˆ°å³é€çº§æ¯”è¾ƒ
- æ”¯æŒé™çº§æ“ä½œï¼ˆéœ€ç”¨æˆ·ç¡®è®¤ï¼‰

## âš ï¸ æ³¨æ„äº‹é¡¹

### å‡çº§å‰å‡†å¤‡
- ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
- ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸
- å»ºè®®åœ¨ä½å³°æœŸè¿›è¡Œå‡çº§

### å‡çº§è¿‡ç¨‹
- clash-meta æœåŠ¡ä¼šçŸ­æš‚åœæ­¢
- å‡çº§è¿‡ç¨‹ä¸­è¯·å‹¿æ‰‹åŠ¨æ“ä½œ
- å‡çº§å®Œæˆåéœ€è¦åˆ·æ–° Web UI

### å¤‡ä»½ç®¡ç†
- å¤‡ä»½æ–‡ä»¶ä¼šå ç”¨ç£ç›˜ç©ºé—´
- å»ºè®®å®šæœŸæ¸…ç†æ—§å¤‡ä»½
- é‡è¦å‡çº§å‰å»ºè®®æ‰‹åŠ¨åˆ›å»ºå¤‡ä»½

### é”™è¯¯å¤„ç†
- å‡çº§å¤±è´¥æ—¶ä¼šä¿ç•™åŸç‰ˆæœ¬
- å¯ä»¥ä»å¤‡ä»½æ¢å¤
- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æ’æŸ¥é—®é¢˜

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç‰ˆæœ¬æ£€æŸ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥ç½‘ç»œè¿æ¥
   curl -s https://api.github.com
   
   # æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
   sudo /opt/proxmox-clash/scripts/management/view_logs.sh -e
   ```

2. **å‡çº§ä¸‹è½½å¤±è´¥**
   ```bash
   # æ£€æŸ¥ GitHub è¿æ¥
   curl -L https://github.com/proxmox-libraries/proxmox-clash-plugin/archive/refs/tags/v1.1.0.tar.gz
   
   # æ‰‹åŠ¨ä¸‹è½½å¹¶è§£å‹
   ```

3. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   ```bash
   # æ£€æŸ¥æœåŠ¡çŠ¶æ€
   sudo systemctl status clash-meta
   
   # æŸ¥çœ‹æœåŠ¡æ—¥å¿—
   sudo journalctl -u clash-meta -f
   ```

### æ¢å¤æ“ä½œ

1. **ä»å¤‡ä»½æ¢å¤**
   ```bash
   sudo /opt/proxmox-clash/scripts/management/upgrade.sh -r backup_20231201_143022
   ```

2. **é‡æ–°å®‰è£…**
   ```bash
   sudo /opt/proxmox-clash/scripts/management/uninstall.sh
   sudo bash scripts/install/install_direct.sh
   ```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š`/var/log/proxmox-clash.log`
2. æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š`sudo systemctl status clash-meta`
3. æäº¤ Issue åˆ°é¡¹ç›®ä»“åº“ 