# Proxmox Clash 插件 v1.2.0 发布说明

**发布日期**: 2024-12-19  
**版本**: v1.2.0  
**代号**: Security Enhancement Release

## 🎯 版本概述

v1.2.0 是一个重要的安全改进版本，主要聚焦于透明代理的安全性和用户体验。本次更新解决了透明代理可能导致网络中断的安全风险，并提供了更安全的配置方案。

## 🔒 安全改进

### 透明代理安全优化

#### 默认关闭透明代理
- **变更**: 透明代理现在默认关闭，需要用户手动启用
- **原因**: 避免因代理不可用导致的网络中断风险
- **影响**: 现有用户需要重新配置透明代理

#### Web UI 控制界面
- **新增**: 透明代理设置面板，包含启用/禁用开关
- **功能**: 实时状态检查和操作确认
- **优势**: 用户友好的界面控制，降低误操作风险

#### 故障转移机制
- **改进**: 代理组配置包含直连作为备选
- **安全**: 确保代理不可用时仍能正常联网
- **配置**: 提供安全配置模板

### 配置安全
- 更新默认配置文件，包含安全的故障转移设置
- 添加本地网络和管理端口直连规则
- 改进 DNS 配置，使用多层备用服务器
- 提供安全配置模板 `config/safe-config.yaml`

### 网络中断恢复
- **新增**: 多种快速恢复方法
- **工具**: 专门的恢复脚本和命令
- **文档**: 详细的故障排除指南

## 🎨 用户界面改进

### Web UI 增强
- 新增透明代理设置面板
- 添加透明代理状态检查功能
- 改进用户交互体验，提供操作确认
- 实时状态更新和错误处理

### API 接口扩展
- 新增 `toggle-transparent-proxy` 接口
- 支持动态启用/禁用透明代理
- 改进配置管理接口
- 增强错误处理和日志记录

## 📚 文档完善

### 新增文档
- [透明代理配置指南](../configuration/transparent-proxy.md) - 详细的安全配置说明
- 更新所有相关文档，反映安全改进
- 添加网络中断恢复指南
- 完善故障排除文档

### 文档改进
- 更新快速配置指南，添加安全提示
- 改进故障排除文档，增加网络中断恢复章节
- 更新 API 文档，包含新接口说明
- 完善安装和使用指南

## 🛠️ 技术改进

### 脚本优化
- 修复安装脚本权限检查逻辑错误
- 改进透明代理配置脚本
- 增强错误处理和日志记录
- 优化脚本执行流程

### 配置管理
- 改进配置文件验证机制
- 增强配置备份和恢复功能
- 优化服务重启流程
- 改进错误处理和用户反馈

## 🔧 问题修复

### 安装问题
- 修复 root 用户权限检查矛盾问题
- 改进脚本执行权限处理
- 优化依赖检查和安装流程

### 配置问题
- 修复透明代理配置冲突
- 改进配置文件语法验证
- 优化服务启动和停止流程

## 📋 兼容性

### 向后兼容
- 保持现有 API 接口兼容性
- 支持现有配置文件格式
- 保持 Web UI 基本功能不变

### 升级说明
- 现有用户需要手动启用透明代理
- 建议使用新的安全配置模板
- 升级过程会自动备份现有配置

## 🔄 升级指南

### 升级前准备
1. **备份配置**: 备份当前配置文件
2. **检查状态**: 确认当前透明代理状态
3. **阅读文档**: 了解新的安全配置

### 升级步骤
```bash
# 1. 备份配置
sudo cp /opt/proxmox-clash/config/config.yaml /opt/proxmox-clash/config/config.yaml.backup

# 2. 升级插件
sudo /opt/proxmox-clash/scripts/upgrade.sh -l

# 3. 检查透明代理状态
sudo /opt/proxmox-clash/scripts/utils/setup_transparent_proxy.sh status

# 4. 根据需要启用透明代理
# 通过 Web UI 或命令行启用
```

## 🔗 相关链接

- [透明代理配置指南](../configuration/transparent-proxy.md)
- [故障排除指南](../troubleshooting/index.md)
- [安装指南](../installation/index.md)

---

**注意**：升级前请务必备份现有配置，并阅读升级指南。
