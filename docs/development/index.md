# å¼€å‘æ–‡æ¡£

æ¬¢è¿ä½¿ç”¨ Proxmox Clash æ’ä»¶å¼€å‘æ–‡æ¡£ï¼æœ¬æŒ‡å—å°†å¸®åŠ©å¼€å‘è€…äº†è§£æ’ä»¶çš„æ¶æ„å’Œå¼€å‘æµç¨‹ã€‚

## ğŸ“š å¼€å‘æ–‡æ¡£

### ğŸ—ï¸ æ¶æ„è®¾è®¡
- **[ç³»ç»Ÿæ¶æ„](architecture.md)** - æ’ä»¶æ•´ä½“æ¶æ„å’Œè®¾è®¡è¯´æ˜
- **[API æ¥å£](api.md)** - PVE API æ¥å£è®¾è®¡å’Œå®ç°
- **[å‰ç«¯ç•Œé¢](ui.md)** - Web UI ç•Œé¢å¼€å‘è¯´æ˜

### ğŸ”§ å¼€å‘å·¥å…·
- **[è„šæœ¬å·¥å…·](../scripts/)** - è„šæœ¬ä½¿ç”¨è¯´æ˜å’Œå·¥å…·æ–‡æ¡£
- **[æ¨¡å—åŒ–æ¶æ„](../scripts/install/)** - å®‰è£…è„šæœ¬æ¨¡å—åŒ–è®¾è®¡

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Proxmox VE   â”‚    â”‚   Clash.Meta    â”‚    â”‚   Management    â”‚
â”‚   Web UI       â”‚â—„â”€â”€â–ºâ”‚   (mihomo)      â”‚â—„â”€â”€â–ºâ”‚   Scripts       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PVE API      â”‚    â”‚   Network       â”‚    â”‚   Configuration â”‚
â”‚   Backend      â”‚    â”‚   Interface     â”‚    â”‚   Files         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶
- **PVE API åç«¯** - Perl æ¨¡å—ï¼Œæä¾› REST API æ¥å£
- **Web UI å‰ç«¯** - JavaScript ç•Œé¢ï¼Œé›†æˆåˆ° Proxmox VE
- **Clash.Meta å†…æ ¸** - mihomo å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¤„ç†ä»£ç†é€»è¾‘
- **ç®¡ç†è„šæœ¬** - Bash è„šæœ¬ï¼Œæä¾›å‘½ä»¤è¡Œç®¡ç†åŠŸèƒ½
- **é…ç½®æ–‡ä»¶** - YAML é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰ä»£ç†è§„åˆ™å’Œè®¾ç½®

## ğŸ”§ å¼€å‘ç¯å¢ƒ

### ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Debian 11+ æˆ– Ubuntu 20.04+
- **Proxmox VE**: 7.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **å¼€å‘å·¥å…·**: Git, Make, Perl, Node.js
- **ä¾èµ–åŒ…**: è§ `requirements.txt` æˆ– `Gemfile`

### ç¯å¢ƒæ­å»º
```bash
# å…‹éš†ä»“åº“
git clone https://github.com/proxmox-libraries/proxmox-clash-plugin.git
cd proxmox-clash-plugin

# å®‰è£…ä¾èµ–
sudo apt update
sudo apt install -y perl-modules libpve-common-perl

# å¼€å‘æ¨¡å¼å®‰è£…
sudo ./scripts/install/install.sh --dev
```

## ğŸ“ ä»£ç ç»“æ„

### ç›®å½•ç»“æ„
```
proxmox-clash-plugin/
â”œâ”€â”€ api/                    # PVE API åç«¯
â”‚   â””â”€â”€ Clash.pm          # ä¸»è¦ API æ¨¡å—
â”œâ”€â”€ scripts/               # ç®¡ç†è„šæœ¬
â”‚   â”œâ”€â”€ install/          # å®‰è£…è„šæœ¬ï¼ˆæ¨¡å—åŒ–ï¼‰
â”‚   â”œâ”€â”€ management/       # ç®¡ç†è„šæœ¬
â”‚   â””â”€â”€ utils/            # å·¥å…·è„šæœ¬
â”œâ”€â”€ service/               # æœåŠ¡é…ç½®
â”‚   â””â”€â”€ clash-meta.service
â”œâ”€â”€ config/                # é…ç½®æ–‡ä»¶
â”œâ”€â”€ web-ui/                # Web ç•Œé¢æºç 
â””â”€â”€ docs/                  # æ–‡æ¡£
```

### æ¨¡å—åŒ–æ¶æ„
å®‰è£…è„šæœ¬é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼ŒåŒ…å«ä»¥ä¸‹æ¨¡å—ï¼š
- **dependency_checker.sh** - ä¾èµ–æ£€æŸ¥
- **file_downloader.sh** - æ–‡ä»¶ä¸‹è½½
- **api_installer.sh** - API å®‰è£…
- **service_installer.sh** - æœåŠ¡å®‰è£…
- **config_creator.sh** - é…ç½®åˆ›å»º
- **link_creator.sh** - é“¾æ¥åˆ›å»º
- **result_display.sh** - ç»“æœæ˜¾ç¤º

## ğŸ”Œ API å¼€å‘

### PVE API æ¥å£
æ’ä»¶æä¾›ä»¥ä¸‹ REST API æ¥å£ï¼š

- `GET /api2/json/nodes/{node}/clash` - è·å–çŠ¶æ€
- `GET /api2/json/nodes/{node}/clash/proxies` - è·å–ä»£ç†åˆ—è¡¨
- `PUT /api2/json/nodes/{node}/clash/proxies/{name}` - åˆ‡æ¢ä»£ç†
- `POST /api2/json/nodes/{node}/clash/subscription/update` - æ›´æ–°è®¢é˜…
- `POST /api2/json/nodes/{node}/clash/setup-transparent-proxy` - é…ç½®é€æ˜ä»£ç†

### å¼€å‘æŒ‡å—
```perl
# ç¤ºä¾‹ï¼šæ·»åŠ æ–°çš„ API ç«¯ç‚¹
sub handle_clash_status {
    my ($param) = @_;
    
    # è·å– Clash çŠ¶æ€
    my $status = get_clash_status();
    
    # è¿”å› JSON å“åº”
    return $status;
}
```

## ğŸ¨ å‰ç«¯å¼€å‘

### Web UI ç»„ä»¶
- **ä¸»æ§åˆ¶é¢æ¿** - ä»£ç†ç®¡ç†å’ŒçŠ¶æ€ç›‘æ§
- **è®¢é˜…ç®¡ç†** - è®¢é˜…æ›´æ–°å’Œé…ç½®
- **é€æ˜ä»£ç†** - é€æ˜ä»£ç†é…ç½®ç•Œé¢
- **æ—¥å¿—æŸ¥çœ‹** - å®æ—¶æ—¥å¿—ç›‘æ§
- **ç‰ˆæœ¬ç®¡ç†** - æ’ä»¶ç‰ˆæœ¬å‡çº§

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: React + TypeScript
- **æ ·å¼**: SCSS æ¨¡å—åŒ–æ ·å¼
- **çŠ¶æ€ç®¡ç†**: Zustand
- **æ„å»ºå·¥å…·**: Vite
- **åŒ…ç®¡ç†**: npm/yarn

### å¼€å‘å‘½ä»¤
```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd web-ui

# å®‰è£…ä¾èµ–
npm install

# å¼€å‘æ¨¡å¼
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# ä»£ç æ£€æŸ¥
npm run lint
```

## ğŸ§ª æµ‹è¯•

### æµ‹è¯•æ¡†æ¶
- **å•å…ƒæµ‹è¯•**: Jest
- **é›†æˆæµ‹è¯•**: è‡ªå®šä¹‰æµ‹è¯•è„šæœ¬
- **æ¨¡å—æµ‹è¯•**: `test_modules.sh`

### è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ¨¡å—æµ‹è¯•
sudo ./scripts/install/test_modules.sh

# è¿è¡Œå®‰è£…éªŒè¯
sudo ./scripts/utils/verify_installation.sh

# è¿è¡ŒæœåŠ¡éªŒè¯
sudo ./scripts/utils/service_validator.sh
```

## ğŸ“¦ æ„å»ºå’Œå‘å¸ƒ

### æ„å»ºæµç¨‹
```bash
# æ„å»ºå‰ç«¯
cd web-ui && npm run build

# æ‰“åŒ…æ’ä»¶
make package

# åˆ›å»ºå‘å¸ƒç‰ˆæœ¬
make release
```

### ç‰ˆæœ¬ç®¡ç†
- ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬å· (SemVer)
- è‡ªåŠ¨ç”Ÿæˆ CHANGELOG
- GitHub Releases é›†æˆ
- ç‰ˆæœ¬æ ‡ç­¾ç®¡ç†

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¼€å‘æµç¨‹
1. Fork é¡¹ç›®ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤ä»£ç å˜æ›´
4. åˆ›å»º Pull Request
5. ä»£ç å®¡æŸ¥å’Œåˆå¹¶

### ä»£ç è§„èŒƒ
- **Perl**: éµå¾ª PVE ç¼–ç è§„èŒƒ
- **JavaScript**: ä½¿ç”¨ ESLint å’Œ Prettier
- **Bash**: éµå¾ª ShellCheck å»ºè®®
- **æ–‡æ¡£**: ä½¿ç”¨ Markdown æ ¼å¼

### æäº¤è§„èŒƒ
```
feat: æ·»åŠ æ–°åŠŸèƒ½
fix: ä¿®å¤ bug
docs: æ›´æ–°æ–‡æ¡£
style: ä»£ç æ ¼å¼è°ƒæ•´
refactor: ä»£ç é‡æ„
test: æ·»åŠ æµ‹è¯•
chore: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **[ä½¿ç”¨æ–¹æ³•](../usage.md)** - è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’Œæ“ä½œæŒ‡å—
- **[API æ¥å£](api.md)** - API æ¥å£è®¾è®¡å’Œå®ç°
- **[ç³»ç»Ÿæ¶æ„](architecture.md)** - æ’ä»¶æ•´ä½“æ¶æ„è¯´æ˜
- **[å‰ç«¯ç•Œé¢](ui.md)** - Web UI ç•Œé¢å¼€å‘è¯´æ˜
- **[è„šæœ¬å·¥å…·](../scripts/)** - è„šæœ¬ä½¿ç”¨è¯´æ˜å’Œå·¥å…·æ–‡æ¡£

## ğŸ”— å¤–éƒ¨èµ„æº

- [Proxmox VE å¼€å‘æ–‡æ¡£](https://pve.proxmox.com/wiki/Developer_Documentation)
- [Clash.Meta æ–‡æ¡£](https://docs.metacubex.one/)
- [React å®˜æ–¹æ–‡æ¡£](https://react.dev/)
- [TypeScript å®˜æ–¹æ–‡æ¡£](https://www.typescriptlang.org/)

---

*æœ€åæ›´æ–°: 2024-12-19*
