---
layout: page-with-sidebar
title: æ¶æ„è®¾è®¡
---

# ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

Proxmox Clash æ’ä»¶é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ·±åº¦é›†æˆåˆ° Proxmox VE ç³»ç»Ÿä¸­ï¼Œæä¾›å®Œæ•´çš„ Clash ç®¡ç†åŠŸèƒ½ã€‚

## ğŸ“‹ æ•´ä½“æ¶æ„

### ç³»ç»Ÿå±‚æ¬¡ç»“æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Proxmox VE Web UI                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Clash æ’ä»¶ç•Œé¢å±‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  çŠ¶æ€ç®¡ç†   â”‚ â”‚  é…ç½®ç®¡ç†   â”‚ â”‚  ä»£ç†ç®¡ç†   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    API æ¥å£å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  æœåŠ¡æ§åˆ¶   â”‚ â”‚  é…ç½®æ“ä½œ   â”‚ â”‚  æ•°æ®æŸ¥è¯¢   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Clash æœåŠ¡å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Clash.Meta â”‚ â”‚  é€æ˜ä»£ç†   â”‚ â”‚  è§„åˆ™å¼•æ“   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ç³»ç»ŸæœåŠ¡å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  systemd    â”‚ â”‚  ç½‘ç»œç®¡ç†   â”‚ â”‚  æ–‡ä»¶ç³»ç»Ÿ   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. å‰ç«¯ç•Œé¢å±‚ (UI Layer)

#### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: ExtJS 6.x
- **è¯­è¨€**: JavaScript ES6+
- **æ ·å¼**: CSS3, SCSS
- **æ„å»º**: Webpack

#### ä¸»è¦ç»„ä»¶
```javascript
// ä¸»ç•Œé¢ç»„ä»¶
PVE.panel.Clash
â”œâ”€â”€ PVE.panel.ClashStatus      // çŠ¶æ€æ˜¾ç¤º
â”œâ”€â”€ PVE.panel.ClashConfig      // é…ç½®ç®¡ç†
â”œâ”€â”€ PVE.panel.ClashProxy       // ä»£ç†ç®¡ç†
â””â”€â”€ PVE.panel.ClashSubscription // è®¢é˜…ç®¡ç†
```

#### èŒè´£
- ç”¨æˆ·äº¤äº’ç•Œé¢
- æ•°æ®å±•ç¤ºå’Œç¼–è¾‘
- çŠ¶æ€ç›‘æ§å’Œåé¦ˆ
- é”™è¯¯å¤„ç†å’Œæç¤º

### 2. API æ¥å£å±‚ (API Layer)

#### æ¥å£è®¾è®¡
```perl
# æœåŠ¡æ§åˆ¶æ¥å£
package PVE::API2::Clash;
â”œâ”€â”€ GET  /status              # è·å–æœåŠ¡çŠ¶æ€
â”œâ”€â”€ POST /start               # å¯åŠ¨æœåŠ¡
â”œâ”€â”€ POST /stop                # åœæ­¢æœåŠ¡
â””â”€â”€ POST /restart             # é‡å¯æœåŠ¡

# é…ç½®ç®¡ç†æ¥å£
package PVE::API2::ClashConfig;
â”œâ”€â”€ GET  /config              # è·å–é…ç½®
â”œâ”€â”€ POST /config              # æ›´æ–°é…ç½®
â””â”€â”€ POST /validate            # éªŒè¯é…ç½®

# ä»£ç†ç®¡ç†æ¥å£
package PVE::API2::ClashProxy;
â”œâ”€â”€ GET  /proxies             # è·å–ä»£ç†åˆ—è¡¨
â”œâ”€â”€ POST /test                # æµ‹è¯•ä»£ç†
â””â”€â”€ POST /switch              # åˆ‡æ¢ä»£ç†
```

#### è®¤è¯å’Œæƒé™
- ç»§æ‰¿ Proxmox VE çš„è®¤è¯ç³»ç»Ÿ
- åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)
- API Token æ”¯æŒ

### 3. æœåŠ¡ç®¡ç†å±‚ (Service Layer)

#### Clash.Meta æœåŠ¡
```bash
# æœåŠ¡é…ç½®
/etc/systemd/system/clash-meta.service
â”œâ”€â”€ ExecStart: /opt/proxmox-clash/clash-meta
â”œâ”€â”€ WorkingDirectory: /opt/proxmox-clash
â”œâ”€â”€ User: clash
â””â”€â”€ Group: clash

# é…ç½®æ–‡ä»¶
/opt/proxmox-clash/config/
â”œâ”€â”€ config.yaml              # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ rules.yaml               # è§„åˆ™æ–‡ä»¶
â””â”€â”€ subscriptions/           # è®¢é˜…ç›®å½•
```

#### æœåŠ¡ç®¡ç†è„šæœ¬
```bash
/opt/proxmox-clash/scripts/
â”œâ”€â”€ install.sh               # å®‰è£…è„šæœ¬
â”œâ”€â”€ upgrade.sh               # å‡çº§è„šæœ¬
â”œâ”€â”€ version_manager.sh       # ç‰ˆæœ¬ç®¡ç†
â””â”€â”€ setup_transparent_proxy.sh # é€æ˜ä»£ç†é…ç½®
```

### 4. ç½‘ç»œå±‚ (Network Layer)

#### é€æ˜ä»£ç†æ¶æ„
```
Internet
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Clash     â”‚ â† ä»£ç†æœåŠ¡å™¨
â”‚   (9090)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  iptables   â”‚ â† æµé‡é‡å®šå‘
â”‚  è§„åˆ™é“¾     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨å±‚     â”‚ â† æœ¬åœ°åº”ç”¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç½‘ç»œé…ç½®
- **ä»£ç†ç«¯å£**: 9090 (HTTP), 9091 (SOCKS5)
- **ç®¡ç†ç«¯å£**: 9092 (API)
- **DNS ç«¯å£**: 5353 (DNS ä»£ç†)

## ğŸ“Š æ•°æ®æµ

### 1. é…ç½®æ›´æ–°æµç¨‹
```
ç”¨æˆ·æ“ä½œ â†’ UI ç»„ä»¶ â†’ API æ¥å£ â†’ é…ç½®éªŒè¯ â†’ æ–‡ä»¶å†™å…¥ â†’ æœåŠ¡é‡å¯
    â”‚         â”‚         â”‚         â”‚         â”‚         â”‚
    â–¼         â–¼         â–¼         â–¼         â–¼         â–¼
  ç•Œé¢æ›´æ–°   æ•°æ®éªŒè¯   æƒé™æ£€æŸ¥   è¯­æ³•æ£€æŸ¥   å¤‡ä»½é…ç½®   çŠ¶æ€æ›´æ–°
```

### 2. çŠ¶æ€ç›‘æ§æµç¨‹
```
Clash æœåŠ¡ â†’ çŠ¶æ€æ£€æŸ¥ â†’ API æ¥å£ â†’ UI ç»„ä»¶ â†’ ç•Œé¢æ›´æ–°
    â”‚         â”‚         â”‚         â”‚         â”‚
    â–¼         â–¼         â–¼         â–¼         â–¼
  è¿›ç¨‹çŠ¶æ€   ç«¯å£ç›‘å¬   æ•°æ®å°è£…   äº‹ä»¶è§¦å‘   å®æ—¶æ˜¾ç¤º
```

### 3. ä»£ç†åˆ‡æ¢æµç¨‹
```
ç”¨æˆ·é€‰æ‹© â†’ UI ç»„ä»¶ â†’ API æ¥å£ â†’ é…ç½®æ›´æ–° â†’ æœåŠ¡é‡å¯ â†’ è¿æ¥æµ‹è¯•
    â”‚         â”‚         â”‚         â”‚         â”‚         â”‚
    â–¼         â–¼         â–¼         â–¼         â–¼         â–¼
  ä»£ç†åˆ—è¡¨   é€‰æ‹©ç¡®è®¤   å‚æ•°éªŒè¯   æ–‡ä»¶æ›´æ–°   è¿›ç¨‹é‡å¯   çŠ¶æ€åé¦ˆ
```

## ğŸ”’ å®‰å…¨è®¾è®¡

### 1. è®¿é—®æ§åˆ¶
- **è®¤è¯**: Proxmox VE æ ‡å‡†è®¤è¯
- **æˆæƒ**: åŸºäºç”¨æˆ·è§’è‰²çš„æƒé™æ§åˆ¶
- **å®¡è®¡**: æ“ä½œæ—¥å¿—è®°å½•

### 2. ç½‘ç»œå®‰å…¨
- **HTTPS**: æ‰€æœ‰ Web æ¥å£ä½¿ç”¨ HTTPS
- **é˜²ç«å¢™**: é™åˆ¶ç®¡ç†ç«¯å£è®¿é—®
- **éš”ç¦»**: ä»£ç†æœåŠ¡ä¸ç³»ç»ŸæœåŠ¡éš”ç¦»

### 3. æ•°æ®å®‰å…¨
- **åŠ å¯†**: æ•æ„Ÿé…ç½®æ•°æ®åŠ å¯†å­˜å‚¨
- **å¤‡ä»½**: é…ç½®æ–‡ä»¶è‡ªåŠ¨å¤‡ä»½
- **éªŒè¯**: é…ç½®æ›´æ–°å‰è¯­æ³•éªŒè¯

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. å‰ç«¯ä¼˜åŒ–
- **æ‡’åŠ è½½**: æŒ‰éœ€åŠ è½½ç»„ä»¶
- **ç¼“å­˜**: é™æ€èµ„æºç¼“å­˜
- **å‹ç¼©**: ä»£ç å’Œèµ„æºå‹ç¼©

### 2. åç«¯ä¼˜åŒ–
- **è¿æ¥æ± **: æ•°æ®åº“è¿æ¥å¤ç”¨
- **ç¼“å­˜**: API å“åº”ç¼“å­˜
- **å¼‚æ­¥**: éé˜»å¡æ“ä½œ

### 3. ç½‘ç»œä¼˜åŒ–
- **è¿æ¥å¤ç”¨**: HTTP Keep-Alive
- **å‹ç¼©**: å“åº”æ•°æ®å‹ç¼©
- **CDN**: é™æ€èµ„æºåˆ†å‘

## ğŸ”„ æ‰©å±•æ€§è®¾è®¡

### 1. æ¨¡å—åŒ–æ¶æ„
- **æ’ä»¶ç³»ç»Ÿ**: æ”¯æŒåŠŸèƒ½æ’ä»¶æ‰©å±•
- **é…ç½®é©±åŠ¨**: åŸºäºé…ç½®çš„åŠŸèƒ½å¼€å…³
- **API ç‰ˆæœ¬**: æ”¯æŒ API ç‰ˆæœ¬ç®¡ç†

### 2. æ°´å¹³æ‰©å±•
- **é›†ç¾¤æ”¯æŒ**: å¤šèŠ‚ç‚¹éƒ¨ç½²
- **è´Ÿè½½å‡è¡¡**: è¯·æ±‚åˆ†å‘
- **æ•°æ®åŒæ­¥**: é…ç½®åŒæ­¥æœºåˆ¶

### 3. å‚ç›´æ‰©å±•
- **èµ„æºç›‘æ§**: ç³»ç»Ÿèµ„æºä½¿ç”¨ç›‘æ§
- **æ€§èƒ½è°ƒä¼˜**: æ ¹æ®è´Ÿè½½è°ƒæ•´å‚æ•°
- **å®¹é‡è§„åˆ’**: åŸºäºä½¿ç”¨æƒ…å†µæ‰©å®¹

## ğŸ› ï¸ éƒ¨ç½²æ¶æ„

### 1. å•æœºéƒ¨ç½²
```
Proxmox VE èŠ‚ç‚¹
â”œâ”€â”€ Clash æ’ä»¶
â”œâ”€â”€ Clash.Meta æœåŠ¡
â””â”€â”€ é€æ˜ä»£ç†é…ç½®
```

### 2. é›†ç¾¤éƒ¨ç½²
```
Proxmox VE é›†ç¾¤
â”œâ”€â”€ èŠ‚ç‚¹ 1: Clash ä¸»æœåŠ¡
â”œâ”€â”€ èŠ‚ç‚¹ 2: Clash å¤‡ç”¨æœåŠ¡
â””â”€â”€ å…±äº«å­˜å‚¨: é…ç½®æ–‡ä»¶
```

### 3. é«˜å¯ç”¨éƒ¨ç½²
```
è´Ÿè½½å‡è¡¡å™¨
â”œâ”€â”€ ä¸»èŠ‚ç‚¹: æ´»è·ƒæœåŠ¡
â”œâ”€â”€ å¤‡ç”¨èŠ‚ç‚¹: çƒ­å¤‡ä»½
â””â”€â”€ ç›‘æ§èŠ‚ç‚¹: å¥åº·æ£€æŸ¥
```

## ğŸ“ å¼€å‘è§„èŒƒ

### 1. ä»£ç è§„èŒƒ
- **å‘½å**: éµå¾ªé¡¹ç›®å‘½åçº¦å®š
- **æ³¨é‡Š**: å…³é”®ä»£ç æ·»åŠ æ³¨é‡Š
- **æµ‹è¯•**: å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%

### 2. æ–‡æ¡£è§„èŒƒ
- **API æ–‡æ¡£**: å®Œæ•´çš„æ¥å£æ–‡æ¡£
- **ç”¨æˆ·æ‰‹å†Œ**: è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜
- **å¼€å‘æ–‡æ¡£**: æŠ€æœ¯å®ç°æ–‡æ¡£

### 3. ç‰ˆæœ¬ç®¡ç†
- **è¯­ä¹‰åŒ–ç‰ˆæœ¬**: éµå¾ª SemVer è§„èŒƒ
- **å˜æ›´æ—¥å¿—**: è¯¦ç»†çš„ç‰ˆæœ¬å˜æ›´è®°å½•
- **å‘å¸ƒæµç¨‹**: æ ‡å‡†åŒ–çš„å‘å¸ƒæµç¨‹

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [API æ–‡æ¡£]({{ site.baseurl }}/development/api.html)
- [UI å¼€å‘æŒ‡å—]({{ site.baseurl }}/development/ui.html)
- [å®‰è£…æŒ‡å—]({{ site.baseurl }}/installation/README.html)
- [é…ç½®ç®¡ç†]({{ site.baseurl }}/configuration/quick-start.html)
